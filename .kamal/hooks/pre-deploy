#!/bin/bash
# Kamal pre-deployment hook

set -e

echo "ðŸ” Running pre-deployment checks..."

# Health check current deployment
if docker ps | grep -q traefik; then
    echo "âœ… Traefik is running"
else
    echo "âš ï¸  Traefik is not running"
fi

# Check disk space
DISK_USAGE=$(df -h / | awk 'NR==2 {print $5}' | sed 's/%//')
if [ "$DISK_USAGE" -gt 90 ]; then
    echo "âŒ Disk usage is > 90%: ${DISK_USAGE}%"
    exit 1
fi

echo "âœ… Pre-deployment checks passed"

