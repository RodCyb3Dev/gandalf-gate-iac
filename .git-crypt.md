# Git-Crypt Setup (Optional)

For teams that want to commit encrypted secrets to git, you can use git-crypt.

## Why Git-Crypt?

- Encrypts sensitive files in git
- Transparent encryption/decryption
- Works with git workflows
- Alternative to 1Password for teams already using git

## Setup

### 1. Install git-crypt

```bash
# macOS
brew install git-crypt

# Ubuntu/Debian
sudo apt-get install git-crypt

# Verify installation
git-crypt --version
```

### 2. Initialize in Repository

```bash
cd /opt/homelab

# Initialize git-crypt
git-crypt init

# Generate a key
git-crypt export-key ../homelab.key

# Store this key securely! Anyone with this key can decrypt your secrets.
```

### 3. Add Users (for teams)

```bash
# Add user by GPG key
git-crypt add-gpg-user USER_GPG_KEY

# Or generate GPG key
gpg --gen-key
git-crypt add-gpg-user user@example.com
```

### 4. Configure What to Encrypt

Create `.gitattributes`:

```bash
cat > .gitattributes << 'EOF'
# Encrypt sensitive files
.env filter=git-crypt diff=git-crypt
*.key filter=git-crypt diff=git-crypt
*.pem filter=git-crypt diff=git-crypt
*secret*.txt filter=git-crypt diff=git-crypt
*password*.txt filter=git-crypt diff=git-crypt
*token*.txt filter=git-crypt diff=git-crypt

# Encrypt config files with secrets
config/authelia/users_database.yml filter=git-crypt diff=git-crypt
config/traefik/acme.json filter=git-crypt diff=git-crypt
config/traefik/cf_api_token.txt filter=git-crypt diff=git-crypt
EOF
```

### 5. Lock and Unlock

```bash
# Lock (encrypt) files
git-crypt lock

# Unlock (decrypt) files
git-crypt unlock /path/to/homelab.key
```

## Comparison: 1Password vs Git-Crypt

| Feature          | 1Password                     | Git-Crypt               |
| ---------------- | ----------------------------- | ----------------------- |
| Setup complexity | Easy                          | Medium                  |
| Team sharing     | Easy (share vault)            | Medium (share key/GPG)  |
| Audit trail      | Built-in                      | Via git history         |
| Secret rotation  | Easy                          | Requires re-encrypt     |
| Cost             | $3.99/month                   | Free                    |
| Best for         | Teams with existing 1Password | Teams already using git |

## Recommendation

**Use 1Password if:**

- You're already using 1Password
- You want easy secret rotation
- You want audit trails
- You have non-technical team members

**Use Git-Crypt if:**

- You want secrets in git
- Your team is git-savvy
- You want zero cost
- You're okay with manual key management

**Use both if:**

- Maximum security (defense in depth)
- Secrets encrypted in git (git-crypt)
- Secrets also in 1Password (easy access)

## Security Note

âš ï¸ **Store your git-crypt key securely!**

- Don't commit it to git
- Store in password manager
- Backup in secure location
- Share securely with team

## More Information

- [Git-Crypt Documentation](https://github.com/AGWA/git-crypt)
- [GPG Key Generation](https://docs.github.com/en/authentication/managing-commit-signature-verification/generating-a-new-gpg-key)
